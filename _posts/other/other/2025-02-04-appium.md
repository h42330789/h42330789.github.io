---
title: appium
author: 独孤流
date: 2025-02-04 00:04:00 +0800
categories: [other, 其他]
tags: [appium]     # TAG names should always be lowercase
---

### 一、安装`appium`相关
```
# 安装node环境，如果没有安装
brew install node
# 查看node版本
node -v
npm -v

# 安装appium,可以是UI版本，也可以是命令行版本，我安装的事命令行版本，方便自动测试脚本运行
npm install -g appium

#  安装驱动
# 查看驱动列表
appium driver list
# 安装iOS的驱动
appium driver install xcuitest

# 安装appium-doctor
npm install -g doctor

# 安装代理，方便端口代理
brew install libimobiledevice
# 查看安装后的代理版本
iproxy --version
# 转发代理，方便运行WebDriverAgent运行起来后可以直接访问 http://localhost:8100/status
iproxy 8100 8100


# 安装Java，如果没有安装
brew install openjdk
# 安装Java环境变量
sudo ln -sfn /usr/local/opt/openjdk/libexec/openjdk.jdk /Library/Java/JavaVirtualMachines/openjdk.jdk
# 配置JAVA_HOME
nano ~/.zshrc  # 对于 Zsh 用户
# 将如下2行写入文件最后
export JAVA_HOME=$(/usr/libexec/java_home)
export PATH=$JAVA_HOME/bin:$PATH
# 然高配置文件生效
source ~/.zshrc  # 对于 Zsh 用户

nano ~/.bash_profile  # 对于 Bash 用户
# 将如下2行写入文件最后
export JAVA_HOME=$(/usr/libexec/java_home)
export PATH=$JAVA_HOME/bin:$PATH
# 然高配置文件生效
source ~/.bash_profile  # 对于 Bash 用户
# 查看JAVA_HOME
echo $JAVA_HOME
```

### 2、安装`appium-inspector`
https://github.com/appium/appium-inspector/releases

### 3、安装`WebDriverAgent`
```
# 下载代码
git clone https://github.com/appium/WebDriverAgent.git
# 使用xcode打开下载的WebDriverAgent.xcodeproj
# 如果是运行真机，需要配置自己账号的bundleId才能运行
# scheme选择WebDriverAgentRunner
# product > Test 或者快捷键 cmd + U

# 下载libarclite_hpinesimulator.a
https://github.com/kamyarelyasi/Libarclite-Files/blob/main/libarclite_iphonesimulator.a
# 拷贝到这个路径下，如果没有arc文件夹，创建arc文件夹
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/arc

# 下载测试目标APP的demo
https://github.com/appium/ios-uicatalog
# 在模拟器上运行UICatlog项目
# 运行好后获取到生成的xxx.app, Product > Show build folder in finder > Products/Debug-iphonesimulator/UICatalog.app
```

### 正式运行看看效果
```
# 运行appium
appium
# 开启WebDriverAgentRunner的test cmd+u
# 开启端口代理
iproxy 8100 8100
# 启动appium inspector
# 配置inspector
{
  "platformName": "iOS", # 测试的平台
  "automationName": "XCUITest", # 测试的驱动
  "platformVersion": "17.0", # 我自己模拟器对应的iOS版本
  "deviceName": "iPhone 15 Pro", # 我模拟器的名称
  "app": "/Users/macbookpro/Documents/study/studyAppium/UICatalog.app" # 我测试的UICatalog.app文件的地址

}

```
![image](/assets/img/appium/appium-1.png)
![image](/assets/img/appium/appium-2.png)
![image](/assets/img/appium/appium-3.png)

----
使用Python进行测试
参考：
- [python-client](https://github.com/appium/python-client)
- [webdriver-test](https://github.com/appium/python-client/tree/master/test/unit/webdriver)
```
# 安装Python相关依赖
# 创建虚拟环境安装
python3 -m venv venv
source venv/bin/activate
# 安装相关依赖
pip3 install Appium-Python-Client
pip3 install selenium
```

创建一个python文件`test.py`
```
from appium import webdriver
from appium.options.ios import XCUITestOptions
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

# 设置自定义选项并加载能力
options = XCUITestOptions().load_capabilities({
    'platformName': 'iOS',
    'platformVersion': '17.0',
    'deviceName': 'iPhone 15 Pro',
    'app': '/Users/macbookpro/Documents/study/studyAppium/UICatalog.app',
    'automationName': 'XCUITest',
    'noReset': True
})

# 启动 Appium 会话
driver = webdriver.Remote(
    'http://127.0.0.1:4723',
    options=options,
    direct_connection=True
)

# 等待并点击第二个单元格
try:
    # 显式等待直到表格单元格可点击
    cell = WebDriverWait(driver, 20).until(
        EC.element_to_be_clickable((By.XPATH, '//XCUIElementTypeTable/XCUIElementTypeCell[1]'))
    )
    # 点击找到的单元格
    cell.click()
    print("Cell clicked!")
except Exception as e:
    print(f"Error: {e}")



# python3 /xxx/xxx/xx/test.py

```